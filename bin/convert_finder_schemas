#!/usr/bin/env ruby

$LOAD_PATH << File.dirname(__FILE__) + "/../lib"
require 'govuk_content_schemas/finder_schema_converter'
require 'json'

def usage
  $stderr.puts "USAGE: #{File.basename(__FILE__)} <finder_schema_1.json ... finder_schema_n.json>"
end

if ARGV.empty?
  usage
  exit(1)
end

class DocumentTypeMapper
  MAPPING = {
    "aaib-reports.json" => "aaib_report",
    "cma-cases.json" => "cma_case",
    "countryside-stewardship-grants.json" => "countryside_stewardship_grant",
    "drug-safety-updates.json" => "drug_safety_update",
    "esi-funds.json" => "european_structural_investment_fund",
    "international-development-funds.json" => "international_development_fund",
    "maib-reports.json" => "maib_report",
    "medical-safety-alerts.json" => "medical_safety_alert",
    "raib-reports.json" => "raib_report",
    "vehicle-recalls-and-faults-alert.json" => "vehicle_recalls_and_faults_alert"
  }

  def call(filename)
    MAPPING.fetch(File.basename(filename))
  end
end

converted = GovukContentSchemas::FinderSchemaConverter.new(document_type_mapper: DocumentTypeMapper.new).call(*ARGV)

puts JSON.pretty_generate(converted)
